# Shell 脚本

## 简介

本文针对 bash 进行。

## 变量

### 变量定义与使用

变量定义直接使用 `=`，注意等号两边不能有空格。

```bash
var="hello"
```

使用变量只需要通过美元符号引用即可，变量名可以加上额外的花括号来帮助解释器识别变量边界。

```bash
echo $var
echo ${var}
```

## 参数

### 参数传递

我们可以在执行 Shell 脚本时，向脚本传递参数，脚本内获取参数的格式为：`$n`。n 代表一个数字，其中 0 为执行的文件名（包含文件路径），1 为执行脚本的第一个参数，2 为执行脚本的第二个参数，以此类推。

### 特殊参数

有几个特殊字符用来处理参数：

| 参数 | 说明                                                         |
| ---- | ------------------------------------------------------------ |
| $#   | 传递到脚本或函数的参数个数                                   |
| $*   | 以一个单字符串显示所有向脚本传递的参数                       |
| $$   | 脚本运行的当前进程ID号                                       |
| $!   | 后台运行的最后一个进程的ID号                                 |
| $@   | 与$*相同，但是使用时加引号，并在引号中返回每个参数。         |
| $-   | 显示Shell使用的当前选项，与set命令功能相同。                 |
| $?   | 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。 |

## 括号

单小括号 `()`

双小括号 `(())`

单中括号 `[]`

双中括号 `[[]]`

## 数据类型

### 字符串

字符串是 shell 编程中最常用最有用的数据类型，字符串可以用单引号，双引号，也可以不用引号。

推荐使用双引号，双引号的优点包括：

- 双引号里可以有变量。
- 双引号里可以出现转义字符。
- 与绝大多数编程语言习惯保持一致。

## 条件语句

### 条件判断

我们经常看到 shell 脚本的条件判断语句有的是单中括号 `[]`，还有的是双中括号 `[[ ]]`。我们使用 type 命令查看一下区别，可以看到**单中括号是 shell 命令而双中括号是 shell 关键字**。

```
$type [ [[ test
[ is a shell builtin
[[ is a shell keyword
test is a shell builtin
```

另外，我们再次查看 `test` 命令，可以发现**单中括号就是 `test` 命令**。

```
$ man test
NAME
       test - check file types and compare values
SYNOPSIS
       test EXPRESSION
       test
       [ EXPRESSION ]
       [ ]
       [ OPTION
```

继续查看 `test` 命令的用法，发现该命令支持各种比较方式，主要包括如下三个用法。

- 整数测试
- 字符串测试
- 文件测试

而这些内容也是大部分 shell 教程所描述的，这就是为什么 shell 脚本看起来不像一个编程语言的原因，因为这是 test 命令的格式。既然是命令，那么 `>` 等符号自然被解释为重定向符号，因此就不能直接当做大于小于号使用了。

然而，关键字 `[[]]` 就没有这些限制了，在 `[[` 中使用 `&&` 和 `||` 表示逻辑与和逻辑或，并且还支持模式匹配。因此使用双中括号可以规避大量逻辑错误。另外，在双中括号中代数比较是自动执行。

### 语法格式

单独使用 if 语句

```bash
if [ condition ]; then
 command1
 command2
fi
```

if else 语句

```bash
if [ condition ]; then
 command1
else
 command2
fi
```

多级 if else 嵌套使用

```bash
if [ condition ]; then
 command1
elif [ condition ]; then
 command2
else
 command3
fi
```

!> 中括号里面条件判断两边的空格是必需的。

### 条件判断

常用的测试条件为：

- 整数测试
- 字符串测试
- 文件测试

整数判断

|          | 使用 [ ] 命令             | 使用                  |      |
| -------- | ------------------------- | --------------------- | ---- |
| 相等     | `if [ "$a" -eq "$b" ]`    |                       |      |
| 不等     | `if [ "$a" -ne "$b" ]`    |                       |      |
| 大于     | `if [ "$a" -gt "$b" ]` 或 | `if (("$a" > "$b"))`  |      |
| 小于     | `if [ "$a" -lt "$b" ]` 或 | `if (("$a" < "$b"))`  |      |
| 大于等于 | `if [ "$a" -ge "$b" ]` 或 | `if (("$a" >= "$b"))` |      |
| 小于等于 | `if [ "$a" -le "$b" ]` 或 | `if (("$a" <= "$b"))` |      |

### for 循环

## 常用示例

创建带有时间戳的文件

```shell
TMS=`date +%Y%m%d-%H%M`
touch $TMS
```

## 参考

- [Advanced Bash-Scripting Guide](http://tldp.org/LDP/abs/html/index.html)
